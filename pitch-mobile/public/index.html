<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<title>4-Player Pitch Card Game</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="lobby.css">
</head>

<!-- FIX: Changed h-screen to h-svh (small viewport height) to respect browser UI -->
<body class="select-none bg-gray-800 text-white h-svh overflow-hidden">

	<div id="auth-container"
		class="hidden w-full h-full absolute inset-0 bg-gray-800 z-50 flex flex-col items-center justify-center">
		<h1 class="text-4xl font-bold mb-8">Pitch Online</h1>
		<div class="flex flex-col gap-4">
			<button id="login-google" class="bg-blue-500 text-white font-bold py-2 px-4 rounded">Login with
				Google</button>
			<button id="login-anonymous" class="bg-gray-500 text-white font-bold py-2 px-4 rounded">Play as
				Guest</button>
		</div>
	</div>

	<div id="lobby-container"
		class="hidden absolute inset-0 bg-gray-800 z-50 flex flex-col items-center justify-center p-4">
		<h1 class="text-3xl font-bold mb-6">Game Lobby</h1>
		<div class="w-full max-w-4xl flex flex-col md:flex-row gap-4">
			<div class="flex-1 bg-gray-700 p-4 rounded-lg">
				<h2 class="text-xl font-semibold mb-3 text-center">Unassigned Players</h2>
				<ul id="unassigned-players-list" class="space-y-2">
					<!-- Players will be added here -->
				</ul>
			</div>
			<div class="flex-1 flex flex-col gap-4">
				<div id="team1" class="team bg-blue-800 p-4 rounded-lg cursor-pointer hover:bg-blue-700">
					<h2 class="text-xl font-semibold mb-3 text-center">Team 1</h2>
					<ul id="team1-players" class="space-y-2">
						<!-- Team 1 players -->
					</ul>
				</div>
				<div id="team2" class="team bg-red-800 p-4 rounded-lg cursor-pointer hover:bg-red-700">
					<h2 class="text-xl font-semibold mb-3 text-center">Team 2</h2>
					<ul id="team2-players" class="space-y-2">
						<!-- Team 2 players -->
					</ul>
				</div>
			</div>
		</div>
		<button id="start-game-button"
			class="mt-8 bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg hidden">Start Game</button>
	</div>

	<!-- 
		FIX: Changed h-screen to h-full to make it fill its parent (the h-svh body)
	-->
	<div id="game-container" class="w-full h-full mx-auto flex flex-col hidden">

		<!-- Header: Scores and Trump -->
		<!-- FIX: Removed the center trump display and w-1/3 from side divs -->
		<header class="flex-shrink-0 flex justify-between items-center p-2 rounded-lg bg-gray-900 bg-opacity-40 z-30">
			<div class="text-left">
				<h2 class="text-lg font-semibold">Opponents: <span id="team2-points-display"
						class="text-yellow-300">0</span></h2>
				<span id="team2-round-points-live" class="text-sm text-gray-400 ml-2">(+0)</span>
			</div>
			<div class="text-right">
				<h2 class="text-lg font-semibold">Your Team: <span id="team1-points-display"
						class="text-yellow-300">0</span></h2>
				<span id="team1-round-points-live" class="text-sm text-gray-400 ml-2">(+0)</span>
			</div>
		</header>

		<!-- 
			Main game area grows to fill space.
			It's a flex container holding ONE in-flow child (player-anchor-container)
			which will grow to fill it.
		-->
		<main class="relative flex-1 flex">
			
			<!-- 
				Player Anchor Container
				This is the single in-flow child (flex-1) that stretches
				to fill <main>. All absolute player elements are
				positioned relative to this full-size container.
			-->
			<div id="player-anchor-container" class="relative flex-1 z-20">
				
				<!-- Player 3 (Top) -->
				<div id="player3-hand" class="absolute top-4 left-1/2 -translate-x-1/2 h-28 w-1/2 z-20"></div>
				<div id="player3-info" class="player-name absolute top-36 left-1/2 -translate-x-1/2 z-40">Player 3</div>
				<div id="player3-status-display"
					class="hidden absolute top-44 left-1/2 -translate-x-1/2 bg-green-700 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40 flex items-center gap-2">
				</div>
				<div id="player3-bid-display"
					class="hidden absolute top-52 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 text-white text-lg font-bold px-4 py-1 rounded-md z-40">
				</div>
				<div id="player3-action-display"
					class="hidden absolute top-52 left-1/2 -translate-x-1/2 bg-blue-600 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40">
				</div>

				<!-- Player 2 (Left) -->
				<div id="player2-hand" class="absolute left-4 top-20 w-28 h-28 sm:h-1/2 z-20"></div>
				<div id="player2-info" class="player-name absolute left-4 top-1/2 -translate-y-1/2 -rotate-90 z-40">Player 2
				</div>
				<div id="player2-status-display"
					class="hidden absolute left-4 top-1/2 -translate-y-12 bg-green-700 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40 flex items-center gap-2">
				</div>
				<div id="player2-bid-display"
					class="hidden absolute left-4 top-1/2 translate-y-4 bg-black bg-opacity-50 text-white text-lg font-bold px-4 py-1 rounded-md z-40">
				</div>
				<div id="player2-action-display"
					class="hidden absolute left-4 top-1/2 translate-y-4 bg-blue-600 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40">
				</div>
				
				<!-- Player 4 (Right) -->
				<div id="player4-hand" class="absolute right-4 top-20 w-28 h-28 sm:h-1/2 z-20"></div>
				<div id="player4-info" class="player-name absolute right-4 top-1/2 -translate-y-1/2 rotate-90 z-40">Player 4
				</div>
				<div id="player4-status-display"
					class="hidden absolute right-4 top-1/2 -translate-y-12 bg-green-700 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40 flex items-center gap-2">
				</div>
				<div id="player4-bid-display"
					class="hidden absolute right-4 top-1/2 translate-y-4 bg-black bg-opacity-50 text-white text-lg font-bold px-4 py-1 rounded-md z-40">
				</div>
				<div id="player4-action-display"
					class="hidden absolute right-4 top-1/2 translate-y-4 bg-blue-600 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-40">
				</div>
				
				<!-- 
					Player 1 (Bottom) 
					FIX: Grouped all Player 1 elements into a single cluster.
					This cluster is positioned from the bottom and will be moved by JS.
					Added transition classes for the "slide" effect.
				-->
				<div id="player1-ui-cluster" class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[90%] sm:w-1/2 z-30 transition-all duration-300 ease-in-out">
					<!-- 
						FIX: All elements below are now positioned relative to the cluster.
						Their 'bottom' values are reset to stack on top of each other
						inside the new parent.
					-->
					<div id="player1-hand" class="absolute bottom-0 left-1/2 -translate-x-1/2 h-24 w-full z-0">
					</div>
					<div id="player1-info" class="player-name absolute bottom-28 left-1/2 -translate-x-1/2 z-10">Player 1</div>
					<div id="player1-status-display"
						class="hidden absolute bottom-36 left-1/2 -translate-x-1/2 bg-green-700 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-10 flex items-center gap-2">
					</div>
					<div id="player1-bid-display"
						class="hidden absolute bottom-44 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 text-white text-lg font-bold px-4 py-1 rounded-md z-10">
					</div>
					<div id="player1-action-display"
						class="hidden absolute bottom-44 left-1/2 -translate-x-1/2 bg-blue-600 bg-opacity-80 text-white text-base font-semibold px-3 py-1 rounded-md z-10">
					</div>
				</div>
			</div>


			<!-- 
				Play Area (Green Circle)
				This is 'absolute' and sits at z-10, *behind* the player container.
			-->
			<div id="play-area" class="absolute inset-0 flex items-center justify-center z-10">
				<div
					class="w-72 h-72 sm:w-80 sm:h-80 bg-green-800 bg-opacity-50 rounded-full border-4 border-yellow-900 shadow-inner grid grid-cols-3 grid-rows-3 relative">
					<div id="widow-hand" class="absolute inset-0 flex items-center justify-center"></div>
					<div id="player3-trick-area" class="col-start-2 row-start-1 flex justify-center items-end"></div>
					<div id="player2-trick-area" class="col-start-1 row-start-2 flex justify-end items-center"></div>
					<div id="player4-trick-area" class="col-start-3 row-start-2 flex justify-start items-center"></div>
					<div id="player1-trick-area" class="col-start-2 row-start-3 flex justify-center items-start"></div>
				</div>
			</div>
		</main>

		<!-- Footer / Action Area -->
		<footer class="flex-shrink-0 h-28 flex flex-col items-center justify-center z-30 relative pt-2">
			<div id="message-box"
				class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p-2 rounded-lg shadow-lg w-max max-w-sm text-center bg-gray-900 bg-opacity-80">
				<p id="message-text" class="text-center"></p>
			</div>
			<div class="flex-grow flex items-center justify-center">
				<div id="bid-buttons-container" class="flex justify-center items-center gap-2 sm:gap-4 hidden"></div>
				<div id="trump-selection-container" class="flex justify-center items-center gap-2 sm:gap-4 hidden">
				</div>
				<div id="discard-button-container" class="hidden">
					<button id="discard-button"
						class="py-3 px-8 bg-purple-600 text-white font-bold rounded-lg shadow-lg text-lg hover:bg-purple-700">Discard
						Selected</button>
				</div>
			</div>
			<!-- FIX: Add version number -->
			<div class="w-full px-4 flex justify-between items-center">
				<button id="full-reset-button" class="text-xs py-1 px-2 bg-red-800 rounded">Reset All</button>
				<!-- FIX: Added version number for verification -->
				<span class="text-xs text-gray-600">v1.9</span>
				<button id="rules-button" class="text-sm py-1 px-3 bg-gray-700 rounded-lg hover:bg-gray-600">Game
					Rules</button>
			</div>
		</footer>
	</div>

	<!-- UI Overlays -->
	<div id="rules-overlay"
		class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
		<div class="bg-gray-800 rounded-lg w-full max-w-3xl max-h-[90%] flex flex-col text-gray-300">
			<!-- Sticky Header -->
			<div
				class="flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
				<h2 class="text-2xl font-bold text-yellow-300">Pitch: Game Rules</h2>
				<button id="close-rules-button"
					class="text-gray-400 hover:text-white text-3xl font-bold">&times;</button>
			</div>

			<!-- Scrollable Content -->
			<div class="overflow-y-auto p-6">
				<div class="rules-section">
					<h3 class="text-lg font-semibold text-white mb-2">Objective</h3>
					<p>Be the first team to reach <strong>21 points</strong>. You are partnered with the player across
						from
						you. Points are scored by winning "tricks" and capturing valuable cards.</p>
				</div>

				<div class="rules-section">
					<h3 class="text-lg font-semibold text-white mb-2">The Flow of a Round</h3>
					<ol class="list-decimal list-inside space-y-2">
						<li><strong>Dealing & Widow:</strong> Each player is dealt 7 cards. A 7-card "widow" is set
							aside,
							with the last card face-up.</li>
						<li><strong>Bidding:</strong> Each player gets a chance to bid on how many points they think
							their
							team can score. The minimum bid is 4. The highest bidder wins the contract.</li>
						<li><strong>Taking the Widow:</strong> The high bidder takes the 7 widow cards into their hand.
						</li>
						<li><strong>Choosing Trump:</strong> After seeing their combined 14 cards, the bidder chooses
							the
							trump suit.</li>
						<li><strong>Discarding:</strong> All players discard cards to get down to a hand of 6 or fewer
							cards, then draw back to 6. The bidder (with 14 cards) must discard at least 8. Other
							players
							(with 7 cards) must discard at least 1.</li>
						<li><strong>Playing Tricks:</strong> The high bidder leads the first trick. The winner of each
							trick
							leads the next until all 6 tricks are played.</li>
						<li><strong>Scoring:</strong> Teams count the points they earned during the round.</li>
					</ol>
				</div>

				<div class="rules-section">
					<h3 class="text-lg font-semibold text-white mb-2">Card Ranks & Trump</h3>
					<p class="mb-2">Any card from the trump suit beats any card from a non-trump suit. The Jokers and
						specific Jacks are always considered part of the trump suit.</p>
					<p><strong>Trump Rank (Highest to Lowest):</strong></p>
					<ol class="list-decimal list-inside font-mono text-sm">
						<li>Ace, King, Queen of the trump suit</li>
						<li>Jack of the trump suit</li>
						<li>Jack of the same color as trump</li>
						<li>High Joker (Red), Low Joker (Black)</li>
						<li>10, 9, 8, 7, 6, 5, 4, 3, 2 of the trump suit</li>
					</ol>
					<p class="mt-2"><strong>Non-Trump Suit Rank:</strong> Ace (high), King, Queen, Jack, 10, 9... 2
						(low).
					</p>
				</div>

				<div class="rules-section">
					<h3 class="text-lg font-semibold text-white mb-2">Playing a Trick</h3>
					<ul class="list-disc list-inside space-y-1">
						<li>The player who leads a trick can play any card.</li>
						<li>Other players must <strong>follow suit</strong> if they can. (e.g., if a Spade is led, you
							must
							play a Spade if you have one).</li>
						<li>If you cannot follow suit, you can play any card, including a trump card ("trumping" the
							trick).
						</li>
						<li>The trick is won by the person who played the highest-ranking trump card. If no trump was
							played, it's won by the highest card of the suit that was led.</li>
					</ul>
				</div>

				<div class="rules-section">
					<h3 class="text-lg font-semibold text-white mb-2">Scoring Points</h3>
					<p>At the end of the round, up to 7 points are awarded. A team gets a point for each of the
						following:</p>
					<ul class="list-disc list-inside space-y-1">
						<li><strong>High:</strong> Capturing the highest trump card played in the round.</li>
						<li><strong>Low:</strong> The team that *plays* the lowest trump card of the round gets this
							point
							(even if they don't win the trick).</li>
						<li><strong>Jack:</strong> Capturing the Jack of the trump suit.</li>
						<li><strong>Off-Jack:</strong> Capturing the Jack of the same color as trump.</li>
						<li><strong>Joker:</strong> One point for each Joker captured.</li>
						<li><strong>Game:</strong> The team with the highest total of "card points" from their captured
							tricks gets one point. (Card Points: 10=10, Ace=4, King=3, Queen=2, Jack=1).</li>
					</ul>
					<p class="font-bold text-red-400 mt-2"><strong>Making the Bid:</strong> If the bidding team scores
						at
						least as many points as their bid, they get all the points they earned. If they fail, their bid
						amount is <strong>subtracted</strong> from their total score. The non-bidding team always keeps
						any
						points they earn.</p>
				</div>
			</div>
		</div>
	</div>

	<div id="round-summary-overlay"
		class="hidden fixed inset-0 bg-black bg-opacity-80 z-40 flex flex-col items-center justify-center p-4">
		<div class="text-center p-4 bg-gray-900 bg-opacity-80 rounded-lg w-full max-w-2xl">
			<h3 class="text-lg font-bold mb-1 text-gray-300">Round Over</h3>
			<div class="grid grid-cols-2 gap-2">
				<div class="bg-gray-800 bg-opacity-50 p-2 rounded-lg">
					<h4 class="font-bold text-lg text-gray-300">Your Team</h4>
					<p>Round: <span id="team1-round-points-display" class="text-green-400">0</span></p>
					<p class="text-xs">Card Points: <span id="team1-card-value-display">0</span></p>
					<div id="team1-point-cards" class="min-h-[5rem] flex flex-wrap justify-center items-center gap-1">
					</div>
				</div>
				<div class="bg-gray-800 bg-opacity-50 p-2 rounded-lg">
					<h4 class="font-bold text-lg text-gray-300">Opponents</h4>
					<p>Round: <span id="team2-round-points-display" class="text-red-400">0</span></p>
					<p class="text-xs">Card Points: <span id="team2-card-value-display">0</span></p>
					<div id="team2-point-cards" class="min-h-[5rem] flex flex-wrap justify-center items-center gap-1">
					</div>
				</div>
			</div>
		</div>
		<div class="mt-4 text-center">
			<h4 class="text-sm font-semibold text-gray-300 mb-2">Remaining Cards in Deck</h4>
			<div id="remaining-deck-display"
				class="relative min-h-24 max-w-2xl flex justify-center items-center flex-wrap gap-1 p-2">
			</div>
		</div>
		<button id="next-round-button" class="py-2 px-6 bg-blue-600 rounded-lg shadow-lg mt-4">Next Round</button>
	</div>

	<div id="trick-winner-popup"
		class="hidden opacity-0 scale-0 fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 text-white text-2xl font-bold p-6 rounded-lg z-50">
	</div>

	<div id="game-over-overlay"
		class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center p-4 text-white">
		<div class="text-center">
			<h2 id="game-over-title" class="text-5xl font-bold mb-4 text-yellow-300">ðŸŽ‰ You Win! ðŸŽ‰</h2>
			<p class="text-xl mb-6">Final Score</p>
			<div class="text-2xl font-semibold flex justify-center gap-8">
				<div>
					<p>Your Team</p>
					<p id="final-score-team1" class="text-green-400 text-4xl">21</p>
				</div>
				<div>
					<p>Opponents</p>
					<p id="final-score-team2" class="text-red-400 text-4xl">15</p>
				</div>
			</div>
		</div>
		<button id="play-again-button"
			class="mt-8 py-3 px-8 bg-blue-600 rounded-lg shadow-lg text-lg font-bold hover:bg-blue-700">Play
			Again</button>
	</div>

	<!-- Points Drawers -->
	<div id="team1-drawer"
		class="fixed top-1/2 -translate-y-1/2 left-0 w-20 bg-gray-900 bg-opacity-80 rounded-r-lg shadow-lg z-40 transform -translate-x-full transition-transform duration-300 ease-in-out">
		<button id="team1-drawer-tab"
			class="absolute top-1/2 -translate-y-1/2 left-full w-8 h-24 bg-blue-800 hover:bg-blue-700 rounded-r-lg flex items-center justify-center">
			<span class="text-xl transform rotate-90">Points</span>
		</button>
		<div class="p-2 drawer-content-area overflow-y-auto">
			<div id="team1-drawer-content" class="flex flex-col items-center gap-2"></div>
		</div>
	</div>

	<div id="team2-drawer"
		class="fixed top-1/2 -translate-y-1/2 right-0 w-20 bg-gray-900 bg-opacity-80 rounded-l-lg shadow-lg z-40 transform translate-x-full transition-transform duration-300 ease-in-out">
		<button id="team2-drawer-tab"
			class="absolute top-1/2 -translate-y-1/2 right-full w-8 h-24 bg-red-800 hover:bg-red-700 rounded-l-lg flex items-center justify-center">
			<span class="text-xl transform -rotate-90">Points</span>
		</button>
		<div class="p-2 drawer-content-area overflow-y-auto">
			<div id="team2-drawer-content" class="flex flex-col items-center gap-2"></div>
		</div>
	</div>
	<script type="module" src="main.js"></script>
</body>

</html>


